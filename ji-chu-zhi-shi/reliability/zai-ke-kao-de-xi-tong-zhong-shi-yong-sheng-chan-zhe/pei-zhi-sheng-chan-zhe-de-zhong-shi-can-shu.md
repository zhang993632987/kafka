# 配置生产者的重试参数

生产者需要处理的错误包括两个部分：

* 一部分是由生产者**自动处理的错误**
* 另一部分是需要开发者**手动处理的错误**

<mark style="color:blue;">**生产者可以自动处理可重试的错误**</mark>。当生产者向 broker 发送消息时，broker可以返回一个成功响应或者错误响应。错误响应可以分为**两种**，一种是在**重试之后可以解决的**，另一种是**无法通过重试解决的**。如果 broker  返回 LEADER\_NOT\_AVAILABLE 错误，那么生产者可以尝试重新发送消息——或许新首领被选举出来了，那么第二次尝试发送就会成功。也就是说，LEADER\_NOT\_AVAILABLE 是一个**可重试**错误。如果 broker 返回 INVALID\_CONFIG 错误，那么即使重试发送消息也无法解决这个问题，所以这样的重试是没有意义的，这是**不可重试**错误。

一般来说，如果你的目标是不丢失消息，那么就让生产者在遇到可重试错误时保持重试。<mark style="color:orange;">**最好的重试方式是使用默认的重试次数（整型最大值或无限），并把 delivery.timeout.ms 配置成我们愿意等待的时长，生产者会在这个时间间隔内一直尝试发送消息。**</mark>

**重试发送消息存在一定的风险，因为如果两条消息都成功写入，则会导致消息重复**。通过重试和小心翼翼地处理异常，可以保证每一条消息都会被保存至少一次，但不能保证只保存一次。<mark style="color:blue;">**如果把 enable.idempotence 参数设置为 true，那么生产者就会在消息里加入一些额外的信息，broker 可以使用这些信息来跳过因重试导致的重复消息。**</mark>
