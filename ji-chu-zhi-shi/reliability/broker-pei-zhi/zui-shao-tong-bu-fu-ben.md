# 最少同步副本

<mark style="color:blue;">**min.insync.replicas**</mark> 参数可以配置在**主题**级别和 **broker** 级别。

尽管为一个主题配置了 3 个副本，还是会出现**只剩下一个同步副本**的情况。如果这个同步副本变为不可用，则必须在可用性和一致性之间做出选择，而这是一个两难的选择。**根据 Kafka 对可靠性保证的定义，一条消息只有在被写入所有同步副本之后才被认为是已提交的，**但**如果这里的“所有”只包含一个同步副本，那么当这个副本变为不可用时，数据就有可能丢失。**

<mark style="color:orange;">**如果想确保已提交的数据被写入不止一个副本，就要把最少同步副本设置得大一些。**</mark>**对于一个包含 3 个副本的主题，如果 min.insync.replicas 被设置为 2，那么至少需要有两个同步副本才能向分区写入数据。**如果有两个副本变为不可用，那么 broker 就会停止接受生产者的请求。尝试发送数据的生产者会收到 **NotEnoughReplicasException** 异常，不过消费者仍然可以继续读取已有的数据。实际上，如果使用这样的配置，那么当只剩下一个同步副本时，它就变成只读的了。
