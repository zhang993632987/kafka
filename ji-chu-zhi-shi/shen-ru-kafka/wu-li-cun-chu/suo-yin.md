# 索引

消费者可以从 Kafka 任意可用的偏移量位置开始读取消息。假设消费者希望从偏移量 100 开始读取 1 MB 消息，那么 broker 就必须立即定位到偏移量 100（可能是在分区的任意一个片段里），然后从这个位置开始读取消息。

<mark style="color:blue;">**为了帮助 broker 更快定位到指定的偏移量，Kafka 为每个分区维护了一个索引**</mark><mark style="color:blue;">。</mark><mark style="color:blue;">**该索引将偏移量与片段文件以及偏移量在文件中的位置做了映射**</mark>**。**

类似地，Kafka 还有**第二个索引**，该索引**将时间戳与消息偏移量做了映射**。在按时间戳搜索消息时会用到这个索引。这种搜索方式在 Kafka Streams 中使用广泛，在一些故障转移场景中也很有用。

> 索引也会被分成片段，所以，在删除消息时也可以删除相应的索引。
>
> Kafka 没有为索引维护校验和。如果索引损坏，那么 Kafka 将通过重新读取消息并记录偏移量和位置来再次生成索引。如果有必要，管理员也可以删除索引，这样做绝对安全（尽管可能需要较长的恢复时间），因为 Kafka 会自动重新生成索引。
