# 文件管理

<mark style="color:blue;">**数据保留**</mark>是 Kafka 的一个重要概念。

Kafka 不会一直保留数据，也不会一直等到消息被所有消费者读取了之后才将其删除。相反，Kafka 管理员会为每个主题配置数据保留期限，主题的**数据要么在达到指定的时间之后被清除，要么在达到指定的数量之后被清除。**

在一个大文件中查找和删除消息既费时又很容易出错，所以我们会**把分区分成若干个片段**。在默认情况下，每个片段包含 1 GB 或一周的数据，以较小的那个为准。在 broker 向分区写入数据时，如果触及任意一个上限，就关闭当前文件，并打开一个新文件。

当前正在写入数据的片段叫作**活动片段**。**活动片段永远不会被删除**，所以，如果你配置的保留时间是 1 天，但片段里包含了 5 天的数据，那么这些数据就会被保留 5 天，因为在片段被关闭之前，这些数据是不会被删除的。

{% hint style="warning" %}
<mark style="color:blue;">**broker 会为分区的每一个打开的日志片段分配一个文件句柄，哪怕是非活动片段。**</mark>**这样就会打开很多文件句柄，因此必须根据实际情况对操作系统做一些调优。**
{% endhint %}
