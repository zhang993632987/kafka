# 删除键

<mark style="color:orange;">**要彻底把一个键从系统中删除，应用程序必须发送包含这个键且值为null的消息**</mark>。压实线程在发现这条消息时，会先进行常规的压实操作，只保留值为null的消息。

这条消息（被称为<mark style="color:blue;">**墓碑消息**</mark>）会根据配置的参数保留一段时间。在此期间，消费者可以读取到这条消息，并且发现它的值已经被置空。**消费者在将Kafka数据复制到关系数据库时，如果它看到这条墓碑消息，就知道应该要把相关的用户信息从数据库中删除。**

在超过保留期限之后，清理线程会移除墓碑消息，它们的键也将从Kafka分区中消失。**这里的关键是要让消费者有足够的时间看到墓碑消息，因为如果消费者离线几小时，那么可能就错过了墓碑消息，也就不会去删除数据库中的相关数据了。**

> ## deleteRecords方法
>
> **Kafka的管理客户端提供了一个**<mark style="color:blue;">**deleteRecords**</mark>**方法。这个方法可用于**<mark style="color:blue;">**删除指定偏移量之前的所有记录**</mark>，但它使用的是一种完全不同的机制。
>
> 当这个方法被调用时，Kafka会将**低水位标记（分区的第一个偏移量）移动到指定的偏移量**。这样可以防止消费者读取低水位标记之前的记录，保证这些记录在被清理线程删除之前都是不可访问的。
>
> **这个方法可用于删除设置了保留策略的主题和压实主题。**
