# 生产请求

首先，包含某个**分区首领**的broker在收到生产请求时会对请求做一些验证。

* 发送数据的用户是否有主题写入**权限**？
* 请求中指定的**acks**是否有效（只允许出现0、1或all）？
* 如果acks=all，那么是否有**足够多的同步副本**保证消息可以被安全写入？

然后，消息将被写入本地磁盘。**在Linux系统中，消息会被写入文件系统缓存**，但**不能保证何时会被冲刷到磁盘上**。<mark style="color:blue;">**Kafka不会一直等待数据被持久化到磁盘上，它主要通过复制功能来保证消息的持久性。**</mark>

一旦消息被写入分区的首领，broker就会检查acks配置参数：

* 如果acks是0或1，那么broker就会立即返回响应；
* 如果acks是all，则请求将被保存在一个叫作**炼狱**的缓冲区中，直到首领确认跟随者副本复制了消息，才将响应返回给客户端。
